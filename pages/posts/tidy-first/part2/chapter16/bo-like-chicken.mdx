# 코드 정리 구분

## 코드 정리는 별도의 PR로 만들고, 가급적 PR당 몇 개의 코드 정리만 넣기

### Pull Request에 사용되는 라벨에 Tidy를 넣어서 의사소통 비용 줄이기

![example](/tidy-label.png)

명시적으로 PR의 목적이 정리임을 알 수 있게 됩니다.
다만, 어디까지를 코드 정리로 간주하고 어디까지를 리팩터링의 범주로 볼 것인지에 대한 구성원끼리의 합의가 필요합니다.

## 코드 정리를 배우는 사람들이 거치는 단계

### 문제

대략 300 줄 정도의 다음과 같은 코드가 있었습니다.

```js filename="원래 코드"
// openapi 명세를 기반으로 타입을 생성하는 커스텀 코드

function main() {
  let url = "https://foo";
  // ... 폴더를 만드는 로직
  // ... 스웨거에서 명세를 가져오는 로직
  // ... 파일 입력 처리를 하는 로직
  // ... 명세를 바탕으로 타입을 생성하는 로직
  // ... 파일 입력 처리를 하는 로직
  // ... 더는 필요없는 파일을 삭제하는 로직
  // ... 기타 방지처리들이 혼합되어있음
  // ... 대략 300 줄
}

main();
```

기능을 추가하려고 보니, 기존의 코드에서 냄새가 나서 함께 바뀌어 버렸습니다.
물론 좋은 방향으로 코드가 개선되었지만, 리뷰어의 입장에서 혹은 나중에 히스토리를 찾아보는 작업자에 입장에서는 보기에 여간 까다로운 것이 아닙니다.

```js {3-11} filename="기능과 정리과 동시에 진행된 코드"
// openapi 명세를 기반으로 타입을 생성하는 커스텀 코드

function main() {
  const SWAGGER_URL = "https://foo";
  폴더_생성();
  명세_획득();
  타입_생성();
  파일_입력();
  맞춤화_수정();
  파일_정리();
}

main();
```

이 상태에서 변경 사항을 나누어 PR을 했더니 리뷰어들에게 의미를 파악할 수 없다는 피드백을 받게 됩니다.

이 문제를 다음과 같은 순서로 헤쳐나갈 수 있습니다.

### 1. 변경의 필요성을 구분합니다

내가 추가할 기능과 코드 정리가 필요해 보이는 영역을 구분합니다.

```js {10} filename="원래 코드에 반영되어야 하는 변경을 구분"
// openapi 명세를 기반으로 타입을 생성하는 커스텀 코드

function main() {
  let url = "https://foo";
  // ... 폴더를 만드는 로직
  // ... 스웨거에서 명세를 가져오는 로직
  // ... 파일 입력 처리를 하는 로직
  // ... 명세를 바탕으로 타입을 생성하는 로직
  // ... 파일 입력 처리를 하는 로직
  // 여기에 새로운 로직을 추가하고 나머지는 정리가 필요해 보입니다
  // ... 더는 필요없는 파일을 삭제하는 로직
  // ... 기타 방지처리들이 혼합되어있음
  // ... 대략 300 줄
}

main();
```

### 2. 코드 정리가 필요한 부분은 헬퍼 함수등을 추출해 보기 좋게 정리합니다

```js {18-23} filename="헬퍼 함수를 추출"
// openapi 명세를 기반으로 타입을 생성하는 커스텀 코드

function main() {
  let url = "https://foo";
  // ... 폴더를 만드는 로직
  // ... 스웨거에서 명세를 가져오는 로직
  // ... 파일 입력 처리를 하는 로직
  // ... 명세를 바탕으로 타입을 생성하는 로직
  // ... 파일 입력 처리를 하는 로직
  // ... 더는 필요없는 파일을 삭제하는 로직
  // ... 기타 방지처리들이 혼합되어있음
  // ... 대략 300 줄
}

main();

function 폴더_생성() {}
function 명세_획득() {}
function 타입_생성() {}
function 파일_입력() {}
function 맞춤화_수정() {}
function 파일_정리() {}
```

### 3. 동작 변경과 구조 변경에 순서를 정리합니다

> 기존의 코드에 기능 추가를 하기 전에 먼저 정리를 하는편이 좋겠어

```js {8} filename="기존 코드에 기능 추가 전 정리"
// openapi 명세를 기반으로 타입을 생성하는 커스텀 코드

function main() {
  const SWAGGER_URL = "https://foo";
  function 폴더_생성() {}
  function 명세_획득() {}
  function 타입_생성() {}
  function 파일_입력() {}
  // 여기에 새로운 로직을 추가할 예정
  function 맞춤화_수정() {}
  function 파일_정리() {}
}

main();
```

### 4. 별도의 PR에 포함된 동작 변경과 구조 변경

이후에는 순서가 정해졌으니, 코드 정리에 대한 PR과 이 시점에서 분기된 기능 추가된 PR을 올려서 리뷰어들을 배려합니다.

## Action Item

1. 다양한 변경의 필요성을 구분하고
2. 동작 변경과 구조 변경에 순서를 정한 후
3. 순서에 따라서 가장 작은 단위의 동작 변경과 구조 변경을 묶어서 PR로 만들자
4. 이것에 모든 구성원들이 능숙해 졌다면 코드 정리에 대한 PR을 건너뛰는 시도를 해보자
